<!DOCTYPE html>
<html lang="en">
    <%-include('./partials/head.ejs')%>
    <link rel="stylesheet" href="/feature.css">
    <link rel="stylesheet" href="/main.css"/>
<body>
    <nav  class="navbar bg-black">
        <div class="container-fluid">
            <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
                <img 
                width="30"
                hegith="30"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
               </span>
               <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                <h5>
                    <a
                      class="nav-link breadcrumb-item active"
                      aria-current="page"
                      href="/"
                      role="button"
                      data-bs-toggle="dropdown"
                      aria-expanded="false"
                      style="color: #fff !important"
                    >
                    <%=product.Name%>
                    </a>
                  </h5>
                </li>
              </ul>
        </div>
      </nav>
      <div class="container p-3 ">
        <form action=""  method="patch" id='form' class="p-2 border shadow bg-light" >
            <input type="text" placeholder="Product Name" name="Name" value="<%=product.Name%>" style="width:570px;padding:10px;font-size: x-large;" required/>
            <div class="d-flex  gap-3 p-5 justify-content-around">
                <!-- cateory -->
                <div>
                    <label  class="d-flex justify-content-between gap-7">
                     Product category
                     <select id="category" name="Categories">
                     <optgroup label="category">
                         <option  class="bg-warning" value="<%=product.category%>"><%=product.category%></option>
                         <option value="Fasion" >Fasion</option>
                         <option value="Edible" >Edible</option>
                         <option value="Electronics" >Electronics</option>
                         <option value="Medicine" >Medicine</option>
                         <option value="others">Others</option>
                     </optgroup>
                    </select>
                 </label>
                </div>
                <!-- image -->
                <div>
                    <div class="flex flex-col">
                        <div id="productImage" <%if(product.image){%>
                            style="background-image: url('<%=product.image%>');filter: drop-shadow(3px 1px 4px black);transition: 0.5s;"
                        <%}%>
                        ></div>
                        <!-- display progress % for photo upload -->
                        <!-- <progress value="0" max="100" id="progress"></progress> -->
                        <input type="url" name="image" disabled id="imageLoader" hidden>
                      </div>
                </div>
            </div>
            <div class="border-b flex font-bold">
                <div class="border-end p-1 subs" name="category" title="Double click to show section">Product information</div>
                <div class="border-end p-1 subs" name="category" title="Double click to show section">Product Settings</div>
                <div class="border-end p-1 subs" name="category" title="Double click to show section">Description</div> 
            </div>
            <!-- prouct information -->
                <div class="flex flex-col gap-9 hidden border-b p-5" id="workInfo">
                    <label class="flex gap-7">
                        Whole-sale price: <input type="number" name="WareHouse_Price" value="<%=product.WareHouse_Price%>" placeholder="Eg 10.00">
                    </label>

                    <div class="input-group mb-3">
                        <span class="input-group-text"> Super Market price N</span>
                        <input type="number" name="Market_Price"  value="<%=product.Market_Price%>" placeholder="Eg 10.00">
                        <span class="input-group-text">.00</span>
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text"> Van price N</span>
                        <input type="number" name="Van_Price"  value="<%=product.Van_Price%>" placeholder="Eg 10.00" >
                        <span class="input-group-text">.00</span>
                    </div>

                    <div class="input-group mb-3">
                        <span class="input-group-text"> Vendor price N</span>
                        <input type="number" class="form-control" name="vendor_Price"  value="<%=product.vendor_Price%>" placeholder="Eg 10.00" aria-label="Amount (to the nearest dollar)">
                        <span class="input-group-text">.00</span>
                    </div>

                    <div class="col-md-7">
                        <label for="pricelist" class="form-label">vendor</label>
                        <select
                          class="form-select "
                          name="vendor"
                          aria-describedby="validationServer04Feedback"
                          required
                        >
                        <option class="bg-warning" value="<%=product.Vendor%>" ><%=product.Vendor%></option>
                        <%if(vendor){%>
                          <%vendor.forEach((vendor)=>{%>
                              <option value="<%=vendor.Name%>"
                              <%if(vendor.block_vendor){%>
                                disabled="true"
                              <%}%>
                              ><%=vendor.Name%></option>
                          <%})%>
                          <%}%>
                        </select>
                        </div>
    
                    <label class="flex gap-9 ">
                        Manufacturer: <input type="text"  value="<%=product.Manufacturer%>"  name="Manufacturer"placeholder='Name of Manufacturer'>
                    </label>
    
                    <label class="flex gap-9 ">
                        Manufacturer Code: <input type="text"  value="<%=product.Manufacture_code%>"  name="ManufacturerCode"placeholder='Name of Manufacturer'>
                    </label>
    
                    <label class="flex gap-9 ">
                        ADC Code: <input type="text"  value="<%=product.product_code%>"  name="AdcCode"placeholder='Name of Manufacturer'id="AdcCode" data-id='<%=product._id%>'>
                    </label>
    
                </div>
                <!-- product settings -->
                <div id="privateinfo" class="flex flex-col hidden gap-5 p-5 border-b ">
                    <div class="flex flex-col gap-7">
                        <h1 class="font-bold text-xl">Unit of Measure (U.O.M)</h1>
                        <label  class="flex  gap-7">
                            U.O.M :
                            <select id="measure" name="UMO">
                            <optgroup label="current">
                                <option class="bg-warning" value="<%=product.UMO%>"><%=product.UMO%></option>
                            </optgroup>
                            <optgroup label="Unit of Measure">
                                <option value="pcs">pcs</option>
                                <option value="Dozen" >Dozen</option>
                                <option value="cm" >cm</option>
                                <option value="inch" >inch</option>
                                <option value="mm" >mm</option>
                                <option value="m" >m</option>
                                <option value="yards" >yards</option>
                                <option value="ounce" >ounce</option>
                                <option value="pound" >pound</option>
                                <option value="grams" >grams</option>
                                <option value="kg" >kg</option>
                                <option value="toone" >toone</option>
                                <option value="stone" >stone</option>
                            </optgroup>
                           </select>
                        </label>
                        <!-- colors -->
                        <label for=""  class="flex  gap-7">
                            Color: <input type="color" value="<%=product.color%>" name="color">
                        </label>
                    </div>
                    <div class="flex gap-7">
                        Is this product to be sold ? (`Product Activation`)
                        <label class="switch">
                            <input type="checkbox" id="ActivateProduct" name="Sellable" 
                            <%if(product.Sellable){%>
                                checked
                            <%}%>
                            >
                            <div class="slider"></div>
                        </label>
                    </div>
                    <!-- OPTION TO DISPLAY ON eCOMMERCE  -->
                    <div class="flex gap-7">
                        Sell this product on E-commerce ? 
                        <label class="switch">
                            <input type="checkbox" name="Ecom_sale" <%if(product.Ecom_sale){%>
                                checked
                            <%}%>>
                            <div class="slider"></div>
                        </label>
                    </div>
            
                    <div class="input-group mb-3">
                        <span class="input-group-text">VAT</span>
                        <input type="number" class="form-control" placeholder='set Value Added tax on this product' name="VAT" value=<%=product.VAT%> aria-label="Amount (to the nearest dollar)">
                        <span class="input-group-text">%</span>
                    </div>
                </div>
                <!-- description -->
                <div id="thirdinfo" class="form-floating">
                        <textarea class="form-control" placeholder="Leave a discription here" rows="4" cols="50" name="Description" id="floatingTextarea" title="please note that description added will reflect on your E-commerce Product Description (EPD). Hence, it should be properly Constructed."><%=product.Description%></textarea>
                        <label for="floatingTextarea">Description</label>
                </div>

                
            <button>Update <%=product.Name%> </button>
        </form>
      </div>
</body>
 <script  src="/Erp.js"></script>
<script>

    const ProductForm = document.getElementById('form');
    ProductForm.addEventListener('submit',async (e)=>{
        e.preventDefault();
   
   const Name = ProductForm.Name.value;
   const category = ProductForm.category.value;
   const WareHouse_Price = ProductForm.WareHouse_Price.value;
   const Market_Price = ProductForm.Market_Price.value;
   const Van_Price = ProductForm.Van_Price.value;
   const Vendor = ProductForm.vendor.value;
   const vendor_Price = ProductForm.vendor_Price.value;
   const UMO = ProductForm.UMO.value;
   const color = ProductForm.elements.color.value;
   const Description = ProductForm.Description.value;
   const ACDcode = ProductForm.AdcCode.value;
   const Sellable =  ProductForm.Sellable.checked;
   const Ecom_sale = ProductForm.Ecom_sale.checked;
   const Manufacturer = ProductForm.Manufacturer.value;
   const Manufacture_code = ProductForm.ManufacturerCode.value;
   const VAT = ProductForm.VAT.value;

   const productId = document.getElementById('AdcCode')
   id = productId.dataset.id
   const endPoint= `/Products/${id}/edit`;
   const update = {Name,
           category,
           WareHouse_Price,
           Market_Price,
           Van_Price,
           vendor_Price,
           Vendor,
           UMO,
           color,
           Description,
           Sellable,
           Ecom_sale,
           Manufacturer,
           Manufacture_code,
           ACDcode,
           VAT}

   const res = await fetch(endPoint,{
       method:'PATCH',
       body:JSON.stringify(update),
       headers:{'Content-Type': 'application/json'}
   })

   const data = await res.json()
   data?.result ? alert(data.result) : alert(data.error)
    })
</script>
</html>